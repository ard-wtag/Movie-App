<div class="bg-white p-8 rounded-lg shadow-md max-w-4xl mx-auto">

  <div class="flex justify-center mb-6">
    <% if @movie.movie_cover.attached? %>
      <%= image_tag url_for(@movie.movie_cover), class: 'w-72 h-96 object-cover' %>
    <% else %>
      <%= image_tag 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSNO3hziJ9HVvBASDh6lMDRX3p6eS_Fb4dvWN0pGyaGETX6yYt3PAl9mBgrqQFPE1fGDTU&usqp=CAU', class: 'w-72 h-96 object-cover' %>
    <% end %>
  </div>

  <h1 class="text-3xl font-bold mb-6 text-center"><%= @movie.title %></h1>
  <p class="text-xl font-semibold mb-4"><strong><%= t('movies.show.director') %>:</strong> <%= @movie.director %></p>
  <p class="text-xl font-semibold mb-4"><strong><%= t('movies.show.rating') %>:</strong> <%= @average_rating %></p>
  <p class="text-xl mb-4"><strong><%= t('movies.show.synopsis') %>:</strong> <%= @movie.synopsis %></p>

  <!-- Display Genres as buttons -->
  <div class="flex flex-wrap gap-2 mb-4">
    <% @movie.genres.each do |genre| %>
      <button class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg">
        <%= genre.genre_type %>
      </button> 
    <% end %>
  </div> 

  <br/>

  <% if current_admin != nil %>
    <div class="flex justify-between mt-6">
      <%= link_to t('movies.show.edit_movie'), edit_movie_path(@movie), class: 'py-2 px-4 bg-green-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 focus:outline-none focus:ring focus:ring-red-300' %>
      <%= link_to t('movies.show.delete_movie'), delete_movie_path(@movie), class: 'py-2 px-4 bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 focus:outline-none focus:ring focus:ring-red-300' %>
    </div>
  <% end %>

  <br/>

  <div class="flex justify-between">
    <%= link_to t('movies.show.back_to_list'), movies_path, class: 'py-2 px-4 bg-gray-300 text-gray-800 font-semibold rounded-lg shadow-md hover:bg-gray-400 focus:outline-none focus:ring focus:ring-gray-300' %>
  </div>

  <br/><br/>

  <hr class="my-6">
  <h2 class="text-2xl font-bold mb-4 text-center"><%= t('movies.show.user_reviews') %></h2>
  <div class="bg-gray-100 p-4 rounded-lg">
    <% if @reviews.any? %>
      <table class="min-w-full bg-white">
        <thead class="bg-gray-800 text-white">
          <tr>
            <th class="py-2 px-4"><%= t('movies.show.user') %></th>
            <th class="py-2 px-4"><%= t('movies.show.review') %></th>
            <th class="py-2 px-4"><%= t('movies.show.rating') %></th>
            <th class="py-2 px-4"><%= t('movies.show.full_review') %></th>
          </tr>
        </thead>
        <tbody>
          <% @reviews.each do |review| %>
            <tr class="bg-gray-100">
              <td class="border px-4 py-2">
                <% if review.user.profile_picture.attached? %>
                  <%= image_tag url_for(review.user.profile_picture), size: "50x50", class: 'rounded-full mr-2' %>
                <% else %>
                  <%= image_tag 'https://st.depositphotos.com/2218212/2938/i/450/depositphotos_29387653-stock-photo-facebook-profile.jpg', size: "50x50", class: 'rounded-full mr-2' %>
                <% end %>
                <%= link_to "#{review.user.first_name} #{review.user.last_name}", user_path(review.user), class: 'text-blue-500 hover:text-blue-700 font-semibold' %>
              </td>
              <td class="border px-4 py-2"><%= truncate(review.review, length: 100) %></td>
              <td class="border px-4 py-2"><%= review.rating %></td>
              <td class="border px-4 py-2">
                <%= link_to t('movies.show.full_review'), review_path(review), class: 'bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded' %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p class="text-center"><%= t('movies.show.no_reviews') %></p>
    <% end %>
  </div>

  <div class="bg-white p-4 rounded-lg shadow-md mt-6">
    <h2 class="text-xl font-bold mb-4"><%= t('movies.show.add_review') %></h2>
    <%= form_with model: [ @movie, Review.new ], local: true do |form| %>
      <div class="mb-4">
        <%= form.label :rating, class: "block text-gray-700" %>
        <%= form.number_field :rating, in: 1..10, class: "mt-1 p-2 w-full border rounded-lg focus:outline-none focus:shadow-outline", required: true %>
      </div>
      <div class="mb-4">
        <%= form.label :review, class: "block text-gray-700" %>
        <%= form.text_area :review, rows: 4, class: "mt-1 p-2 w-full border rounded-lg focus:outline-none focus:shadow-outline", required: true %>
      </div>
      <div>
        <%= form.submit t('movies.show.submit_review'), class: 'py-2 px-4 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600 focus:outline-none focus:ring focus:ring-blue-300' %>
      </div>
    <% end %>
  </div>

</div>
